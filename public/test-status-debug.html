<!DOCTYPE html>
<html>
<head>
    <title>Status Debug Test</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
</head>
<body>
    <div class="container mt-5">
        <h1>Status Debug Test</h1>
        <button class="btn btn-primary" onclick="debugStatuses()">Debug Statuses</button>
        <button class="btn btn-secondary" onclick="testUpdateDashboard()">Test Update Dashboard</button>
        <button class="btn btn-success" onclick="showActiveDeliveries()">Show Active Deliveries</button>
        <div id="output" class="mt-3"></div>
    </div>

    <script>
        function debugStatuses() {
            const output = document.getElementById('output');
            
            // Check if window.activeDeliveries exists
            if (typeof window.activeDeliveries === 'undefined') {
                output.innerHTML = '<div class="alert alert-warning">window.activeDeliveries is undefined</div>';
                return;
            }
            
            // Get active deliveries
            const activeDeliveries = window.activeDeliveries;
            
            // Display count
            output.innerHTML = `<div class="alert alert-info">Active Deliveries Count: ${activeDeliveries.length}</div>`;
            
            // Display status values
            if (activeDeliveries.length > 0) {
                const statuses = activeDeliveries.map(d => d.status || 'undefined');
                const uniqueStatuses = [...new Set(statuses)];
                
                output.innerHTML += `
                    <div class="alert alert-success">
                        <h5>Unique Status Values:</h5>
                        <ul>
                            ${uniqueStatuses.map(status => `<li>${status}</li>`).join('')}
                        </ul>
                    </div>
                `;
                
                // Show sample deliveries
                output.innerHTML += `
                    <div class="alert alert-info">
                        <h5>Sample Deliveries (first 3):</h5>
                        <pre>${JSON.stringify(activeDeliveries.slice(0, 3), null, 2)}</pre>
                    </div>
                `;
                
                // Test the calculateStatusBreakdown function if available
                if (typeof window.calculateStatusBreakdown === 'function') {
                    try {
                        const breakdown = window.calculateStatusBreakdown();
                        output.innerHTML += `
                            <div class="alert alert-primary">
                                <h5>Status Breakdown:</h5>
                                <pre>${JSON.stringify(breakdown, null, 2)}</pre>
                            </div>
                        `;
                    } catch (error) {
                        output.innerHTML += `<div class="alert alert-danger">Error calling calculateStatusBreakdown: ${error.message}</div>`;
                    }
                } else {
                    output.innerHTML += '<div class="alert alert-warning">calculateStatusBreakdown function not available</div>';
                }
            } else {
                output.innerHTML += '<div class="alert alert-warning">No active deliveries found</div>';
            }
        }
        
        function testUpdateDashboard() {
            const output = document.getElementById('output');
            
            if (typeof window.updateDashboardStats === 'function') {
                try {
                    window.updateDashboardStats();
                    output.innerHTML = '<div class="alert alert-success">updateDashboardStats called successfully</div>';
                } catch (error) {
                    output.innerHTML = `<div class="alert alert-danger">Error calling updateDashboardStats: ${error.message}</div>`;
                }
            } else {
                output.innerHTML = '<div class="alert alert-warning">updateDashboardStats function not available</div>';
            }
        }
        
        function showActiveDeliveries() {
            const output = document.getElementById('output');
            
            if (typeof window.activeDeliveries !== 'undefined') {
                output.innerHTML = `
                    <div class="alert alert-info">
                        <h5>All Active Deliveries:</h5>
                        <pre>${JSON.stringify(window.activeDeliveries, null, 2)}</pre>
                    </div>
                `;
            } else {
                output.innerHTML = '<div class="alert alert-warning">window.activeDeliveries is undefined</div>';
            }
        }
    </script>
</body>
</html>
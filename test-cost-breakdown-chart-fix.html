<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Cost Breakdown Chart Fix</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .chart-container { width: 400px; height: 400px; margin: 20px 0; }
        button { padding: 10px 20px; margin: 10px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .log { background: #f8f9fa; padding: 10px; border-radius: 4px; margin: 10px 0; font-family: monospace; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>🧪 Cost Breakdown Chart Fix Test</h1>
    
    <div class="chart-container">
        <canvas id="costBreakdownChart"></canvas>
    </div>
    
    <button onclick="testChartUpdate()">Test Chart Update</button>
    <button onclick="testChartCreation()">Test Chart Creation</button>
    <button onclick="clearLog()">Clear Log</button>
    
    <div id="log" class="log">Ready to test...\n</div>

    <!-- Include the analytics error fix -->
    <script src="assets/js/analytics-error-fix.js"></script>
    
    <script>
        function log(message) {
            const logDiv = document.getElementById('log');
            logDiv.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('log').textContent = 'Log cleared...\n';
        }
        
        function testChartUpdate() {
            log('🧪 Testing chart update...');
            
            // Test the safe update function
            if (window.safeUpdateCostBreakdownChart) {
                window.safeUpdateCostBreakdownChart('month');
                log('✅ Chart update function called');
            } else {
                log('❌ Chart update function not found');
            }
        }
        
        function testChartCreation() {
            log('🧪 Testing chart creation...');
            
            const testData = {
                labels: ['Fuel', 'Tolls', 'Parking', 'Other'],
                values: [150, 50, 25, 75],
                colors: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0']
            };
            
            if (window.createCostBreakdownChart) {
                const chart = window.createCostBreakdownChart(testData);
                if (chart) {
                    log('✅ Chart created successfully');
                } else {
                    log('❌ Chart creation failed');
                }
            } else {
                log('❌ Chart creation function not found');
            }
        }
        
        // Log when page loads
        window.addEventListener('load', () => {
            log('📄 Page loaded');
            log('📊 Chart.js available: ' + (typeof Chart !== 'undefined'));
            log('🔧 Analytics fix loaded: ' + (window.analyticsErrorFix ? 'Yes' : 'No'));
        });
    </script>
</body>
</html>
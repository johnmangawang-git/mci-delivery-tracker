<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test DR Upload Scroll Fix</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .test-content {
            height: 200vh;
            background: linear-gradient(to bottom, #f8f9fa, #e9ecef);
        }
        .scroll-indicator {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            z-index: 9999;
        }
    </style>
</head>
<body>
    <div class="scroll-indicator">
        <div>Scroll Position: <span id="scrollPos">0</span>px</div>
        <div>Body Overflow: <span id="bodyOverflow">auto</span></div>
        <div>Modal Open: <span id="modalOpen">false</span></div>
    </div>

    <div class="container mt-4">
        <h2>DR Upload Scroll Fix Test</h2>
        
        <div class="alert alert-info">
            <strong>Test Instructions:</strong>
            <ol>
                <li>Click "Simulate DR Upload" to test the modal behavior</li>
                <li>Check if you can scroll after the modal closes</li>
                <li>Use Ctrl+Shift+S to manually fix scroll issues</li>
                <li>Monitor the scroll indicator in the top-right corner</li>
            </ol>
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Status Dropdown Test</h5>
                    </div>
                    <div class="card-body">
                        <p>Test the fixed status dropdown:</p>
                        <div class="status-dropdown-container">
                            <span class="badge bg-warning status-clickable" onclick="toggleTestDropdown()">
                                <i class="bi bi-exclamation-triangle"></i> Delayed
                                <i class="bi bi-chevron-down ms-1"></i>
                            </span>
                            <div class="status-dropdown" id="testStatusDropdown" style="display: none; position: absolute; background: white; border: 1px solid #ccc; border-radius: 4px; padding: 10px; z-index: 1000;">
                                <div class="status-option" onclick="selectTestStatus('Active')">
                                    <i class="bi bi-check-circle"></i> Active
                                </div>
                                <div class="status-option" onclick="selectTestStatus('In Transit')">
                                    <i class="bi bi-truck"></i> In Transit
                                </div>
                                <div class="status-option" onclick="selectTestStatus('Delayed')">
                                    <i class="bi bi-exclamation-triangle"></i> Canceled
                                </div>
                                <div class="status-option" onclick="selectTestStatus('Sold Undelivered')">
                                    <i class="bi bi-exclamation-triangle"></i> Sold Undelivered
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Scroll Test</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-primary" onclick="simulateDRUpload()">Simulate DR Upload</button>
                        <button class="btn btn-secondary" onclick="testScrolling()">Test Scrolling</button>
                        <button class="btn btn-warning" onclick="forceScrollFix()">Force Scroll Fix</button>
                        <div id="testResults" class="mt-3"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Test Modal -->
    <div class="modal fade" id="testModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Simulated DR Upload</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>This simulates the DR upload process...</p>
                    <div class="progress">
                        <div class="progress-bar" id="progressBar" style="width: 0%"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="completeSimulation()">Complete Upload</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="test-content">
        <div class="container">
            <h3 class="mt-5">Scroll Test Content</h3>
            <p>This is a long page to test scrolling functionality.</p>
            
            <div class="row">
                <div class="col-12">
                    <div class="card mb-4" style="height: 300px;">
                        <div class="card-body d-flex align-items-center justify-content-center">
                            <h4>Section 1</h4>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-12">
                    <div class="card mb-4" style="height: 300px;">
                        <div class="card-body d-flex align-items-center justify-content-center">
                            <h4>Section 2</h4>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-12">
                    <div class="card mb-4" style="height: 300px;">
                        <div class="card-body d-flex align-items-center justify-content-center">
                            <h4>Section 3 - Bottom</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="public/assets/js/dr-upload-scroll-fix.js"></script>
    
    <script>
        // Update scroll indicator
        function updateScrollIndicator() {
            document.getElementById('scrollPos').textContent = window.pageYOffset;
            document.getElementById('bodyOverflow').textContent = window.getComputedStyle(document.body).overflow;
            document.getElementById('modalOpen').textContent = document.body.classList.contains('modal-open');
        }
        
        window.addEventListener('scroll', updateScrollIndicator);
        setInterval(updateScrollIndicator, 1000);
        
        // Test functions
        function toggleTestDropdown() {
            const dropdown = document.getElementById('testStatusDropdown');
            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
        }
        
        function selectTestStatus(status) {
            alert(`Selected status: ${status}`);
            document.getElementById('testStatusDropdown').style.display = 'none';
        }
        
        function simulateDRUpload() {
            const modal = new bootstrap.Modal(document.getElementById('testModal'));
            modal.show();
            
            // Simulate progress
            let progress = 0;
            const interval = setInterval(() => {
                progress += 10;
                document.getElementById('progressBar').style.width = progress + '%';
                if (progress >= 100) {
                    clearInterval(interval);
                }
            }, 200);
        }
        
        function completeSimulation() {
            // Simulate the problematic modal cleanup
            document.body.classList.add('modal-open');
            document.body.style.overflow = 'hidden';
            
            // Create fake backdrop
            const backdrop = document.createElement('div');
            backdrop.className = 'modal-backdrop fade show';
            document.body.appendChild(backdrop);
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('testModal'));
            modal.hide();
            
            // Test the scroll fix
            setTimeout(() => {
                if (window.drUploadScrollFix) {
                    window.drUploadScrollFix.forceModalCleanup();
                }
                
                document.getElementById('testResults').innerHTML = 
                    '<div class="alert alert-success">Simulation completed! Test scrolling now.</div>';
            }, 500);
        }
        
        function testScrolling() {
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
            setTimeout(() => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }, 2000);
        }
        
        function forceScrollFix() {
            if (window.drUploadScrollFix) {
                window.drUploadScrollFix.forceModalCleanup();
                document.getElementById('testResults').innerHTML = 
                    '<div class="alert alert-info">Scroll fix applied manually!</div>';
            }
        }
        
        // Simulate the confirmDRUpload function for testing
        window.confirmDRUpload = function() {
            return new Promise((resolve) => {
                console.log('Simulated confirmDRUpload called');
                setTimeout(() => {
                    resolve('success');
                }, 1000);
            });
        };
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test New Columns Display</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
</head>
<body>
    <div class="container mt-4">
        <h2>New Columns Display Test</h2>
        
        <div class="alert alert-info">
            <strong>Testing:</strong> Booked Date, Item #, Mobile #, Item Description, Serial Number columns
        </div>
        
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Sample Active Deliveries Table</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped" id="testActiveDeliveriesTable">
                                <thead>
                                    <tr>
                                        <th><input type="checkbox" class="form-check-input"></th>
                                        <th>DR Number</th>
                                        <th>Customer</th>
                                        <th>Vendor#</th>
                                        <th>Origin</th>
                                        <th>Destination</th>
                                        <th>Truck</th>
                                        <th>Status</th>
                                        <th>Delivery Date</th>
                                        <th>Booked Date</th>
                                        <th>Item #</th>
                                        <th>Mobile#</th>
                                        <th>Item Description</th>
                                        <th>Serial Number</th>
                                    </tr>
                                </thead>
                                <tbody id="testTableBody">
                                    <!-- Test data will be inserted here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <button class="btn btn-primary" onclick="loadTestData()">Load Test Data</button>
                        <button class="btn btn-secondary" onclick="enhanceTable()">Enhance Columns</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Column Data Test</h5>
                    </div>
                    <div class="card-body">
                        <div id="testResults"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="public/assets/js/new-columns-display-fix.js"></script>
    
    <script>
        // Sample test data
        const testDeliveries = [
            {
                id: 'test-1',
                drNumber: 'DR001',
                customerName: 'Test Customer 1',
                vendorNumber: 'V001',
                origin: 'Manila',
                destination: 'Cebu',
                truck: 'Truck A (ABC-123)',
                status: 'Active',
                deliveryDate: '2024-01-15',
                bookedDate: '2024-01-10',
                itemNumber: 'ITEM001',
                mobileNumber: '09123456789',
                itemDescription: 'Refrigerator - 2 Door',
                serialNumber: 'SN123456789'
            },
            {
                id: 'test-2',
                drNumber: 'DR002',
                customerName: 'Test Customer 2',
                vendorNumber: 'V002',
                origin: 'Quezon City',
                destination: 'Davao',
                truck: 'Truck B (DEF-456)',
                status: 'In Transit',
                deliveryDate: '2024-01-16',
                bookedDate: '2024-01-11',
                itemNumber: 'ITEM002',
                mobileNumber: '09987654321',
                itemDescription: 'Washing Machine - Front Load',
                serialNumber: 'SN987654321'
            },
            {
                id: 'test-3',
                drNumber: 'DR003',
                customerName: 'Test Customer 3',
                vendorNumber: 'V003',
                origin: 'Makati',
                destination: 'Iloilo',
                truck: 'Truck C (GHI-789)',
                status: 'Delayed',
                deliveryDate: '2024-01-17',
                bookedDate: '2024-01-12',
                itemNumber: '', // Empty to test fallback
                mobileNumber: '', // Empty to test fallback
                itemDescription: '', // Empty to test fallback
                serialNumber: '' // Empty to test fallback
            }
        ];
        
        // Mock global functions
        window.activeDeliveries = testDeliveries;
        
        function getStatusInfo(status) {
            switch (status) {
                case 'Active':
                    return { class: 'bg-success', icon: 'bi-check-circle' };
                case 'In Transit':
                    return { class: 'bg-primary', icon: 'bi-truck' };
                case 'Delayed':
                    return { class: 'bg-warning', icon: 'bi-exclamation-triangle' };
                default:
                    return { class: 'bg-secondary', icon: 'bi-question-circle' };
            }
        }
        
        function loadTestData() {
            const tableBody = document.getElementById('testTableBody');
            
            tableBody.innerHTML = testDeliveries.map(delivery => {
                const statusInfo = getStatusInfo(delivery.status);
                const displayStatus = delivery.status === 'Delayed' ? 'Canceled' : delivery.status;
                
                return `
                    <tr data-delivery-id="${delivery.id}">
                        <td><input type="checkbox" class="form-check-input"></td>
                        <td><strong>${delivery.drNumber}</strong></td>
                        <td>${delivery.customerName}</td>
                        <td>${delivery.vendorNumber}</td>
                        <td>${delivery.origin}</td>
                        <td>${delivery.destination}</td>
                        <td>${delivery.truck}</td>
                        <td>
                            <span class="badge ${statusInfo.class}">
                                <i class="bi ${statusInfo.icon}"></i> ${displayStatus}
                            </span>
                        </td>
                        <td>${delivery.deliveryDate}</td>
                        <td>${delivery.bookedDate || 'N/A'}</td>
                        <td>${delivery.itemNumber || ''}</td>
                        <td>${delivery.mobileNumber || ''}</td>
                        <td>${delivery.itemDescription || ''}</td>
                        <td>${delivery.serialNumber || ''}</td>
                    </tr>
                `;
            }).join('');
            
            document.getElementById('testResults').innerHTML = 
                '<div class="alert alert-success">Test data loaded! Check the table above.</div>';
        }
        
        function enhanceTable() {
            if (window.newColumnsDisplayFix) {
                // Simulate the enhancement
                const tableBody = document.getElementById('testTableBody');
                const rows = tableBody.querySelectorAll('tr');
                
                rows.forEach(row => {
                    const deliveryId = row.getAttribute('data-delivery-id');
                    const delivery = testDeliveries.find(d => d.id === deliveryId);
                    
                    if (delivery) {
                        const cells = row.querySelectorAll('td');
                        
                        // Update empty cells with fallback values
                        if (cells[10] && cells[10].textContent.trim() === '') {
                            cells[10].textContent = delivery.itemNumber || '-';
                        }
                        if (cells[11] && cells[11].textContent.trim() === '') {
                            cells[11].textContent = delivery.mobileNumber || '-';
                        }
                        if (cells[12] && cells[12].textContent.trim() === '') {
                            cells[12].textContent = delivery.itemDescription || '-';
                        }
                        if (cells[13] && cells[13].textContent.trim() === '') {
                            cells[13].textContent = delivery.serialNumber || '-';
                        }
                    }
                });
                
                document.getElementById('testResults').innerHTML = 
                    '<div class="alert alert-info">Table enhanced! Empty cells should now show "-" for missing data.</div>';
            } else {
                document.getElementById('testResults').innerHTML = 
                    '<div class="alert alert-warning">Enhancement script not loaded.</div>';
            }
        }
        
        // Auto-load test data when page loads
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(loadTestData, 500);
        });
    </script>
</body>
</html>
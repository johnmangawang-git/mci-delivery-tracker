<!DOCTYPE html>
<html>
<head>
    <title>Emergency Diagnostic Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f8f9fa; }
        .diagnostic { background: white; border: 1px solid #ddd; margin: 10px 0; padding: 15px; border-radius: 8px; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .warning { background: #fff3cd; border-color: #ffeaa7; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; font-family: monospace; white-space: pre-wrap; max-height: 300px; overflow-y: auto; border-radius: 4px; }
        button { padding: 10px 15px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-warning { background: #ffc107; color: black; }
    </style>
</head>
<body>
    <h1>üö® Emergency Diagnostic Test</h1>
    
    <div class="diagnostic">
        <h2>JavaScript Syntax Check</h2>
        <button onclick="checkSyntax()" class="btn-primary">Check Syntax</button>
        <div id="syntaxResult"></div>
    </div>
    
    <div class="diagnostic">
        <h2>Function Availability Check</h2>
        <button onclick="checkFunctions()" class="btn-success">Check Functions</button>
        <div id="functionResult"></div>
    </div>
    
    <div class="diagnostic">
        <h2>Booking Modal Test</h2>
        <button onclick="testBookingModal()" class="btn-warning">Test Booking Modal</button>
        <div id="bookingResult"></div>
    </div>
    
    <div class="diagnostic">
        <h2>Console Log</h2>
        <div id="consoleLog" class="log"></div>
        <button onclick="clearLog()" class="btn-danger">Clear Log</button>
    </div>
    
    <script>
        let consoleLog = document.getElementById('consoleLog');
        
        // Override console.log to capture output
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            logToDiv('LOG: ' + args.join(' '));
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            logToDiv('ERROR: ' + args.join(' '), 'error');
        };
        
        function logToDiv(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\\n`;
            consoleLog.textContent += logEntry;
            consoleLog.scrollTop = consoleLog.scrollHeight;
        }
        
        function clearLog() {
            consoleLog.textContent = '';
        }
        
        function checkSyntax() {
            const result = document.getElementById('syntaxResult');
            result.innerHTML = '<p>Checking JavaScript syntax...</p>';
            
            try {
                // Try to create a simple function to test syntax
                const testCode = 'function test() { return true; }';
                eval(testCode);
                result.innerHTML = '<div class="success"><h3>‚úÖ Syntax Check Passed</h3><p>No syntax errors detected in test code.</p></div>';
                
                // Test if we can access the booking.js functions
                setTimeout(() => {
                    if (typeof window.initBookingModal === 'function') {
                        result.innerHTML += '<div class="success"><p>‚úÖ booking.js loaded successfully</p></div>';
                    } else {
                        result.innerHTML += '<div class="error"><p>‚ùå booking.js functions not available</p></div>';
                    }
                }, 1000);
                
            } catch (error) {
                result.innerHTML = `<div class="error"><h3>‚ùå Syntax Error Detected</h3><p>${error.message}</p></div>`;
            }
        }
        
        function checkFunctions() {
            const result = document.getElementById('functionResult');
            const functions = [
                'initBookingModal',
                'openBookingModal', 
                'showBookingModal',
                'showMapPinDialog'
            ];
            
            let html = '<h3>Function Availability:</h3>';
            let allAvailable = true;
            
            functions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    html += `<div class="success">‚úÖ ${funcName} - Available</div>`;
                } else {
                    html += `<div class="error">‚ùå ${funcName} - Not Available</div>`;
                    allAvailable = false;
                }
            });
            
            if (allAvailable) {
                html += '<div class="success"><h4>üéâ All functions are available!</h4></div>';
            } else {
                html += '<div class="error"><h4>‚ö†Ô∏è Some functions are missing</h4></div>';
            }
            
            result.innerHTML = html;
        }
        
        function testBookingModal() {
            const result = document.getElementById('bookingResult');
            result.innerHTML = '<p>Testing booking modal functionality...</p>';
            
            try {
                // Test if initBookingModal can be called
                if (typeof window.initBookingModal === 'function') {
                    console.log('Testing initBookingModal...');
                    window.initBookingModal();
                    result.innerHTML = '<div class="success"><h3>‚úÖ Booking Modal Test Passed</h3><p>initBookingModal executed successfully</p></div>';
                } else {
                    result.innerHTML = '<div class="error"><h3>‚ùå Booking Modal Test Failed</h3><p>initBookingModal function not available</p></div>';
                }
                
                // Test if openBookingModal can be called
                if (typeof window.openBookingModal === 'function') {
                    console.log('Testing openBookingModal...');
                    // Don't actually call it, just verify it exists
                    result.innerHTML += '<div class="success"><p>‚úÖ openBookingModal function available</p></div>';
                } else {
                    result.innerHTML += '<div class="error"><p>‚ùå openBookingModal function not available</p></div>';
                }
                
            } catch (error) {
                result.innerHTML = `<div class="error"><h3>‚ùå Booking Modal Test Error</h3><p>${error.message}</p></div>`;
            }
        }
        
        // Auto-run diagnostics on page load
        window.addEventListener('load', function() {
            console.log('üö® Emergency Diagnostic Test Started');
            
            // Load the booking.js file
            const script = document.createElement('script');
            script.src = 'assets/js/booking.js';
            script.onload = function() {
                console.log('‚úÖ booking.js loaded');
                setTimeout(() => {
                    checkSyntax();
                    checkFunctions();
                }, 1000);
            };
            script.onerror = function() {
                console.error('‚ùå Failed to load booking.js');
                document.getElementById('syntaxResult').innerHTML = '<div class="error"><h3>‚ùå Failed to load booking.js</h3></div>';
            };
            document.head.appendChild(script);
        });
    </script>
</body>
</html>"
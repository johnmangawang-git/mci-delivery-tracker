<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test EPOD Save</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
</head>
<body>
    <div class="container mt-5">
        <h1>Test EPOD Save</h1>
        <p class="lead">This page tests the EPOD save functionality</p>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Test Controls</h5>
                    </div>
                    <div class="card-body">
                        <button id="saveTestRecord" class="btn btn-primary mb-2">Save Test EPOD Record</button>
                        <button id="viewRecords" class="btn btn-secondary mb-2">View EPOD Records</button>
                        <button id="clearRecords" class="btn btn-danger mb-2">Clear EPOD Records</button>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Status</h5>
                    </div>
                    <div class="card-body">
                        <div id="status" class="alert alert-secondary">
                            Ready to test EPOD save
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card mt-4">
            <div class="card-header">
                <h5>EPOD Records</h5>
            </div>
            <div class="card-body">
                <pre id="recordsDisplay" class="bg-light p-3" style="max-height: 300px; overflow-y: auto;">
No records yet
                </pre>
            </div>
        </div>
    </div>

    <script>
        // Update status display
        function updateStatus(message, type = 'info') {
            const statusElement = document.getElementById('status');
            statusElement.className = `alert alert-${type}`;
            statusElement.textContent = message;
        }
        
        // Update records display
        function updateRecordsDisplay() {
            try {
                const ePodRecords = JSON.parse(localStorage.getItem('ePodRecords') || '[]');
                document.getElementById('recordsDisplay').textContent = JSON.stringify(ePodRecords, null, 2);
            } catch (error) {
                document.getElementById('recordsDisplay').textContent = 'Error reading localStorage: ' + error.message;
            }
        }
        
        // Save test EPOD record
        function saveTestRecord() {
            updateStatus('Saving test EPOD record...', 'info');
            
            // Simple signature data (1x1 transparent PNG)
            const signatureData = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg==';
            
            // Create test EPOD record with required fields
            const testRecord = {
                drNumber: 'DR-TEST-' + Date.now(),
                customerName: 'Test Customer',
                customerContact: '09123456789',
                truckPlate: 'ABC123',
                origin: 'Test Origin',
                destination: 'Test Destination',
                signature: signatureData,
                status: 'Completed',
                signedAt: new Date().toISOString(),
                timestamp: new Date().toISOString()
            };
            
            try {
                // Save to localStorage
                let ePodRecords = JSON.parse(localStorage.getItem('ePodRecords') || '[]');
                ePodRecords.push(testRecord);
                localStorage.setItem('ePodRecords', JSON.stringify(ePodRecords));
                
                updateStatus(`Test EPOD record saved: ${testRecord.drNumber}`, 'success');
                console.log('Test EPOD record saved:', testRecord);
                
                // Update display
                updateRecordsDisplay();
            } catch (error) {
                updateStatus('Error saving test EPOD record: ' + error.message, 'danger');
                console.error('Error saving test EPOD record:', error);
            }
        }
        
        // View records
        function viewRecords() {
            updateStatus('Viewing EPOD records...', 'info');
            
            try {
                const ePodRecords = JSON.parse(localStorage.getItem('ePodRecords') || '[]');
                updateStatus(`Found ${ePodRecords.length} EPOD records`, 'success');
                console.log('EPOD records:', ePodRecords);
                
                // Update display
                updateRecordsDisplay();
            } catch (error) {
                updateStatus('Error viewing EPOD records: ' + error.message, 'danger');
                console.error('Error viewing EPOD records:', error);
            }
        }
        
        // Clear records
        function clearRecords() {
            updateStatus('Clearing EPOD records...', 'info');
            
            try {
                localStorage.removeItem('ePodRecords');
                updateStatus('All EPOD records cleared', 'success');
                console.log('All EPOD records cleared');
                
                // Update display
                updateRecordsDisplay();
            } catch (error) {
                updateStatus('Error clearing EPOD records: ' + error.message, 'danger');
                console.error('Error clearing EPOD records:', error);
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Set up event listeners
            document.getElementById('saveTestRecord').addEventListener('click', saveTestRecord);
            document.getElementById('viewRecords').addEventListener('click', viewRecords);
            document.getElementById('clearRecords').addEventListener('click', clearRecords);
            
            // Initial display update
            updateRecordsDisplay();
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EPOD Save Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>EPOD Save Test</h1>
        <button id="testSave" class="btn btn-primary">Test EPOD Save</button>
        <button id="checkRecords" class="btn btn-secondary">Check EPOD Records</button>
        <div id="output" class="mt-3"></div>
    </div>

    <script src="public/assets/js/dataService.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            // Initialize dataService
            if (typeof window.dataService !== 'undefined') {
                await window.dataService.init();
                console.log('Data service initialized');
            }

            document.getElementById('testSave').addEventListener('click', async function() {
                const testRecord = {
                    drNumber: 'DR-TEST-001',
                    customerName: 'Test Customer',
                    customerContact: '09123456789',
                    truckPlate: 'ABC123',
                    origin: 'Test Origin',
                    destination: 'Test Destination',
                    signature: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg==',
                    status: 'Completed',
                    signedAt: new Date().toISOString(),
                    timestamp: new Date().toISOString()
                };

                try {
                    console.log('Saving test EPOD record...');
                    if (typeof window.dataService !== 'undefined' && typeof window.dataService.saveEPodRecord === 'function') {
                        const result = await window.dataService.saveEPodRecord(testRecord);
                        console.log('EPOD record saved via dataService:', result);
                        document.getElementById('output').innerHTML = '<div class="alert alert-success">EPOD record saved via dataService!</div>';
                    } else {
                        // Fallback to localStorage
                        let ePodRecords = JSON.parse(localStorage.getItem('ePodRecords') || '[]');
                        ePodRecords.push(testRecord);
                        localStorage.setItem('ePodRecords', JSON.stringify(ePodRecords));
                        console.log('EPOD record saved to localStorage');
                        document.getElementById('output').innerHTML = '<div class="alert alert-success">EPOD record saved to localStorage!</div>';
                    }
                } catch (error) {
                    console.error('Error saving EPOD record:', error);
                    document.getElementById('output').innerHTML = '<div class="alert alert-danger">Error saving EPOD record: ' + error.message + '</div>';
                }
            });

            document.getElementById('checkRecords').addEventListener('click', async function() {
                try {
                    console.log('Checking EPOD records...');
                    if (typeof window.dataService !== 'undefined' && typeof window.dataService.getEPodRecords === 'function') {
                        const records = await window.dataService.getEPodRecords();
                        console.log('EPOD records from dataService:', records);
                        document.getElementById('output').innerHTML = '<div class="alert alert-info">EPOD records from dataService: ' + records.length + '</div>';
                        if (records.length > 0) {
                            console.log('First record:', records[0]);
                        }
                    } else {
                        // Fallback to localStorage
                        const ePodRecords = JSON.parse(localStorage.getItem('ePodRecords') || '[]');
                        console.log('EPOD records from localStorage:', ePodRecords);
                        document.getElementById('output').innerHTML = '<div class="alert alert-info">EPOD records from localStorage: ' + ePodRecords.length + '</div>';
                        if (ePodRecords.length > 0) {
                            console.log('First record:', ePodRecords[0]);
                        }
                    }
                } catch (error) {
                    console.error('Error checking EPOD records:', error);
                    document.getElementById('output').innerHTML = '<div class="alert alert-danger">Error checking EPOD records: ' + error.message + '</div>';
                }
            });
        });
    </script>
</body>
</html>
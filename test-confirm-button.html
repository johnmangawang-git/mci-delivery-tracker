<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confirm Button Test - MCI Delivery System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; background: #f8f9fa; }
        .test-container { max-width: 800px; margin: 0 auto; }
        .test-section { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .log-area { background: #f8f9fa; padding: 15px; border-radius: 6px; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-section">
            <h3>üîò Confirm Button Event Listener Test</h3>
            <p class="text-muted">Testing if the confirm booking button event listener is working</p>
            
            <div class="alert alert-info">
                <strong>Instructions:</strong>
                <ol>
                    <li>Open your main app in another tab</li>
                    <li>Open the booking modal</li>
                    <li>Fill out the form</li>
                    <li>Click "Confirm Booking"</li>
                    <li>Watch the log below for any activity</li>
                </ol>
            </div>
        </div>

        <div class="test-section">
            <h5>Button Status Check</h5>
            <div class="row">
                <div class="col-md-6">
                    <p><strong>Button Element:</strong> <span id="buttonStatus">Checking...</span></p>
                    <p><strong>Event Listener:</strong> <span id="listenerStatus">Checking...</span></p>
                    <p><strong>saveBooking Function:</strong> <span id="functionStatus">Checking...</span></p>
                </div>
                <div class="col-md-6">
                    <button id="testDirectCall" class="btn btn-primary">Test Direct saveBooking() Call</button>
                    <button id="testButtonClick" class="btn btn-outline-primary">Simulate Button Click</button>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h5>Activity Log</h5>
            <div id="activityLog" class="log-area">
                <div>Monitoring started...</div>
            </div>
            <button id="clearLog" class="btn btn-sm btn-outline-secondary mt-2">Clear Log</button>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const logArea = document.getElementById('activityLog');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'color: red' : type === 'success' ? 'color: green' : type === 'warning' ? 'color: orange' : '';
            logArea.innerHTML += `<div style="${color}">[${timestamp}] ${message}</div>`;
            logArea.scrollTop = logArea.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }

        function checkButtonStatus() {
            log('Checking confirm booking button status...');
            
            // Check if button exists
            const button = document.getElementById('confirmBookingBtn');
            const buttonStatus = document.getElementById('buttonStatus');
            
            if (button) {
                buttonStatus.innerHTML = '<span style="color: green">‚úÖ Found</span>';
                log('‚úÖ confirmBookingBtn element found', 'success');
                
                // Check if it has event listeners (we can't directly check, but we can test)
                const listenerStatus = document.getElementById('listenerStatus');
                listenerStatus.innerHTML = '<span style="color: orange">‚ö†Ô∏è Cannot detect directly</span>';
                log('‚ö†Ô∏è Cannot directly detect event listeners', 'warning');
            } else {
                buttonStatus.innerHTML = '<span style="color: red">‚ùå Not Found</span>';
                log('‚ùå confirmBookingBtn element not found', 'error');
                
                const listenerStatus = document.getElementById('listenerStatus');
                listenerStatus.innerHTML = '<span style="color: red">‚ùå No button</span>';
            }
            
            // Check saveBooking function
            const functionStatus = document.getElementById('functionStatus');
            if (typeof window.saveBooking === 'function') {
                functionStatus.innerHTML = '<span style="color: green">‚úÖ Available</span>';
                log('‚úÖ saveBooking function is available', 'success');
            } else {
                functionStatus.innerHTML = '<span style="color: red">‚ùå Not Available</span>';
                log('‚ùå saveBooking function not available', 'error');
            }
        }

        function setupMonitoring() {
            log('Setting up monitoring...');
            
            // Monitor saveBooking calls
            if (typeof window.saveBooking === 'function') {
                const originalSaveBooking = window.saveBooking;
                window.saveBooking = function(...args) {
                    log('üéØ saveBooking() called!', 'success');
                    log('Arguments: ' + JSON.stringify(args), 'info');
                    
                    try {
                        const result = originalSaveBooking.apply(this, args);
                        log('‚úÖ saveBooking() completed successfully', 'success');
                        return result;
                    } catch (error) {
                        log('‚ùå saveBooking() threw error: ' + error.message, 'error');
                        throw error;
                    }
                };
                log('‚úÖ saveBooking monitoring set up', 'success');
            } else {
                log('‚ùå Cannot monitor saveBooking - function not available', 'error');
            }

            // Monitor button clicks
            const button = document.getElementById('confirmBookingBtn');
            if (button) {
                // Add our own listener to monitor clicks
                button.addEventListener('click', function(event) {
                    log('üîò Confirm booking button clicked!', 'success');
                    log('Event details: ' + JSON.stringify({
                        type: event.type,
                        target: event.target.id,
                        timestamp: event.timeStamp
                    }), 'info');
                }, true); // Use capture phase to catch it first
                
                log('‚úÖ Button click monitoring set up', 'success');
            } else {
                log('‚ùå Cannot monitor button - element not found', 'error');
            }
        }

        function testDirectCall() {
            log('üß™ Testing direct saveBooking() call...', 'warning');
            
            if (typeof window.saveBooking === 'function') {
                try {
                    window.saveBooking();
                    log('‚úÖ Direct call completed', 'success');
                } catch (error) {
                    log('‚ùå Direct call failed: ' + error.message, 'error');
                }
            } else {
                log('‚ùå Cannot test - saveBooking function not available', 'error');
            }
        }

        function testButtonClick() {
            log('üß™ Testing simulated button click...', 'warning');
            
            const button = document.getElementById('confirmBookingBtn');
            if (button) {
                try {
                    button.click();
                    log('‚úÖ Button click simulated', 'success');
                } catch (error) {
                    log('‚ùå Button click simulation failed: ' + error.message, 'error');
                }
            } else {
                log('‚ùå Cannot simulate click - button not found', 'error');
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ Confirm button test initialized');
            
            // Wait a bit for other scripts to load
            setTimeout(() => {
                checkButtonStatus();
                setupMonitoring();
            }, 1000);
            
            // Set up test buttons
            document.getElementById('testDirectCall').addEventListener('click', testDirectCall);
            document.getElementById('testButtonClick').addEventListener('click', testButtonClick);
            
            document.getElementById('clearLog').addEventListener('click', function() {
                document.getElementById('activityLog').innerHTML = '<div>Log cleared...</div>';
            });
            
            // Periodic status check
            setInterval(checkButtonStatus, 5000);
        });
    </script>
</body>
</html>
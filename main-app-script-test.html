<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Main App Script Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h3>Main App Script Loading Test</h3>
        <div class="alert alert-info">
            <p><strong>This page loads the same scripts as your main app.</strong></p>
            <p>If the scripts load here but not in your main app, there's an issue with your main app's HTML.</p>
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <h5>Script Loading Status:</h5>
                <div id="scriptStatus">Loading...</div>
            </div>
            <div class="col-md-6">
                <h5>Function Availability:</h5>
                <div id="functionStatus">Checking...</div>
            </div>
        </div>
        
        <div class="mt-3">
            <button id="testBooking" class="btn btn-primary">Test Booking Creation</button>
            <button id="testLoadDeliveries" class="btn btn-secondary">Test Load Deliveries</button>
        </div>
        
        <div class="mt-3">
            <h5>Test Results:</h5>
            <div id="testResults" class="alert alert-secondary">Ready to test...</div>
        </div>
    </div>

    <!-- Load the same scripts as your main app -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/modal-utils.js"></script>
    <script src="assets/js/calendar.js"></script>
    <script src="assets/js/booking.js"></script>
    <script src="assets/js/customers.js"></script>
    <script src="assets/js/analytics.js"></script>
    <script src="assets/js/warehouse.js"></script>
    <script src="assets/js/main-fixed.js"></script>
    <script src="assets/js/e-signature.js"></script>
    <script src="assets/js/app.js"></script>

    <script>
        function checkScripts() {
            const scriptStatus = document.getElementById('scriptStatus');
            const functionStatus = document.getElementById('functionStatus');
            
            let statusHtml = '';
            let functionHtml = '';
            
            // Check functions
            const functions = [
                'saveBooking',
                'loadActiveDeliveries',
                'populateActiveDeliveriesTable'
            ];
            
            functions.forEach(funcName => {
                const available = typeof window[funcName] === 'function';
                functionHtml += `<div>${funcName}: ${available ? '✅ Available' : '❌ Missing'}</div>`;
            });
            
            // Check variables
            const variables = [
                'activeDeliveries',
                'deliveryHistory'
            ];
            
            variables.forEach(varName => {
                const available = typeof window[varName] !== 'undefined';
                functionHtml += `<div>window.${varName}: ${available ? '✅ Available' : '❌ Missing'}</div>`;
            });
            
            scriptStatus.innerHTML = 'Scripts loaded at: ' + new Date().toLocaleTimeString();
            functionStatus.innerHTML = functionHtml;
        }
        
        function testBookingCreation() {
            const testResults = document.getElementById('testResults');
            
            if (typeof window.saveBooking === 'function') {
                testResults.innerHTML = `
                    <div class="alert alert-success">
                        <h6>✅ Success!</h6>
                        <p>saveBooking function is available. Your scripts are loading correctly.</p>
                        <p><strong>Problem:</strong> Your main app might have a different issue.</p>
                    </div>
                `;
            } else {
                testResults.innerHTML = `
                    <div class="alert alert-danger">
                        <h6>❌ Failed!</h6>
                        <p>saveBooking function is not available. Scripts are not loading.</p>
                        <p><strong>Problem:</strong> JavaScript files are not being served correctly.</p>
                    </div>
                `;
            }
        }
        
        function testLoadDeliveries() {
            const testResults = document.getElementById('testResults');
            
            if (typeof window.loadActiveDeliveries === 'function') {
                testResults.innerHTML = `
                    <div class="alert alert-success">
                        <h6>✅ Success!</h6>
                        <p>loadActiveDeliveries function is available.</p>
                        <p>Try calling it: <button onclick="window.loadActiveDeliveries()" class="btn btn-sm btn-primary">Call loadActiveDeliveries()</button></p>
                    </div>
                `;
            } else {
                testResults.innerHTML = `
                    <div class="alert alert-danger">
                        <h6>❌ Failed!</h6>
                        <p>loadActiveDeliveries function is not available.</p>
                    </div>
                `;
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(checkScripts, 2000);
            
            document.getElementById('testBooking').addEventListener('click', testBookingCreation);
            document.getElementById('testLoadDeliveries').addEventListener('click', testLoadDeliveries);
        });
    </script>
</body>
</html>
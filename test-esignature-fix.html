<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Signature Fix Test - MCI Delivery System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body { padding: 20px; background: #f8f9fa; }
        .test-container { max-width: 1000px; margin: 0 auto; }
        .test-section { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .status-log { background: #f8f9fa; padding: 15px; border-radius: 6px; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-section">
            <h2><i class="bi bi-pen text-primary"></i> E-Signature Fix Test</h2>
            <p class="text-muted">Testing e-signature functionality to identify and fix issues</p>
            
            <div class="alert alert-info">
                <h6><i class="bi bi-info-circle"></i> What we're testing:</h6>
                <ul class="mb-0">
                    <li>E-signature button availability and functionality</li>
                    <li>Signature pad library loading</li>
                    <li>Modal opening and initialization</li>
                    <li>Function availability and calls</li>
                </ul>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="test-section">
                    <h5>üîß Function Status</h5>
                    <div class="status-log" id="functionStatus">
                        <div>Checking function availability...</div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="test-section">
                    <h5>üìã Element Status</h5>
                    <div class="status-log" id="elementStatus">
                        <div>Checking DOM elements...</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h5>üß™ E-Signature Tests</h5>
            <div class="row">
                <div class="col-md-8">
                    <div class="d-flex gap-2 flex-wrap">
                        <button id="testShowModal" class="btn btn-primary">Test showESignatureModal</button>
                        <button id="testSignaturePad" class="btn btn-secondary">Test Signature Pad</button>
                        <button id="testButtonClick" class="btn btn-info">Test E-Signature Button</button>
                        <button id="checkLibraries" class="btn btn-warning">Check Libraries</button>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="verboseLogging">
                        <label class="form-check-label" for="verboseLogging">Verbose Logging</label>
                    </div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h5>üìù Test Log</h5>
            <div id="testLog" class="status-log">
                <div>E-signature test initialized...</div>
            </div>
            <button id="clearLog" class="btn btn-sm btn-outline-secondary mt-2">Clear Log</button>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const logArea = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'color: red' : type === 'success' ? 'color: green' : type === 'warning' ? 'color: orange' : '';
            logArea.innerHTML += `<div style="${color}">[${timestamp}] ${message}</div>`;
            logArea.scrollTop = logArea.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }

        function checkFunctions() {
            const functionStatus = document.getElementById('functionStatus');
            let statusHtml = '';
            
            const functions = [
                'showESignatureModal',
                'openRobustSignaturePad',
                'initializeRobustSignaturePad',
                'getRobustSignatureData',
                'saveRobustSignature'
            ];
            
            functions.forEach(funcName => {
                const available = typeof window[funcName] === 'function';
                const status = available ? '‚úÖ Available' : '‚ùå Missing';
                statusHtml += `<div>${funcName}: ${status}</div>`;
                
                if (document.getElementById('verboseLogging').checked) {
                    log(`Function ${funcName}: ${available ? 'Available' : 'Missing'}`, available ? 'success' : 'error');
                }
            });
            
            functionStatus.innerHTML = statusHtml;
        }

        function checkElements() {
            const elementStatus = document.getElementById('elementStatus');
            let statusHtml = '';
            
            const elements = [
                'eSignatureBtn',
                'eSignatureModal',
                'saveSignatureBtn',
                'signaturePad'
            ];
            
            elements.forEach(elementId => {
                const element = document.getElementById(elementId);
                const status = element ? '‚úÖ Found' : '‚ùå Missing';
                statusHtml += `<div>${elementId}: ${status}</div>`;
                
                if (document.getElementById('verboseLogging').checked) {
                    log(`Element ${elementId}: ${element ? 'Found' : 'Missing'}`, element ? 'success' : 'error');
                }
            });
            
            elementStatus.innerHTML = statusHtml;
        }

        function testShowModal() {
            log('üß™ Testing showESignatureModal function...', 'warning');
            
            if (typeof window.showESignatureModal === 'function') {
                try {
                    window.showESignatureModal('DR-TEST-001');
                    log('‚úÖ showESignatureModal called successfully', 'success');
                } catch (error) {
                    log(`‚ùå Error calling showESignatureModal: ${error.message}`, 'error');
                }
            } else {
                log('‚ùå showESignatureModal function not available', 'error');
            }
        }

        function testSignaturePad() {
            log('üß™ Testing signature pad initialization...', 'warning');
            
            if (typeof window.openRobustSignaturePad === 'function') {
                try {
                    window.openRobustSignaturePad('DR-TEST-001', 'Test Customer', '123-456-7890', 'ABC-123', 'Manila to Quezon City');
                    log('‚úÖ openRobustSignaturePad called successfully', 'success');
                } catch (error) {
                    log(`‚ùå Error calling openRobustSignaturePad: ${error.message}`, 'error');
                }
            } else {
                log('‚ùå openRobustSignaturePad function not available', 'error');
            }
        }

        function testButtonClick() {
            log('üß™ Testing e-signature button...', 'warning');
            
            const button = document.getElementById('eSignatureBtn');
            if (button) {
                try {
                    button.click();
                    log('‚úÖ E-signature button clicked', 'success');
                } catch (error) {
                    log(`‚ùå Error clicking e-signature button: ${error.message}`, 'error');
                }
            } else {
                log('‚ùå E-signature button not found', 'error');
            }
        }

        function checkLibraries() {
            log('üß™ Checking required libraries...', 'warning');
            
            const libraries = [
                { name: 'Bootstrap', check: () => typeof bootstrap !== 'undefined' },
                { name: 'SignaturePad', check: () => typeof SignaturePad !== 'undefined' },
                { name: 'jQuery', check: () => typeof $ !== 'undefined' }
            ];
            
            libraries.forEach(lib => {
                const available = lib.check();
                log(`${lib.name}: ${available ? '‚úÖ Available' : '‚ùå Missing'}`, available ? 'success' : 'error');
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ E-signature test initialized', 'success');
            
            setTimeout(() => {
                checkFunctions();
                checkElements();
            }, 2000);

            // Event listeners
            document.getElementById('testShowModal').addEventListener('click', testShowModal);
            document.getElementById('testSignaturePad').addEventListener('click', testSignaturePad);
            document.getElementById('testButtonClick').addEventListener('click', testButtonClick);
            document.getElementById('checkLibraries').addEventListener('click', checkLibraries);
            
            document.getElementById('clearLog').addEventListener('click', function() {
                document.getElementById('testLog').innerHTML = '<div>Log cleared...</div>';
            });

            // Periodic checks
            setInterval(() => {
                checkFunctions();
                checkElements();
            }, 5000);
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCI Delivery Tracker</title>
    
    <!-- Bootstrap 5.3.0 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    
    <!-- Leaflet CSS for maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <!-- Sidebar Navigation -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <div class="logo-icon">
                    <i class="bi bi-truck"></i>
                </div>
                <span class="logo-text">MCI App</span>
            </div>
        </div>
        <div class="px-2 py-2">
            <ul class="nav flex-column">
                <li class="nav-item">
                    <a href="#" class="nav-link active" data-view="booking">
                        <i class="bi bi-calendar-check"></i>
                        <span class="nav-text">Delivery Booking</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-view="analytics">
                        <i class="bi bi-bar-chart-line"></i>
                        <span class="nav-text">Analytics Dashboard</span>
                    </a>
                </li>
                
                <li class="nav-item">
                    <a href="#" class="nav-link" data-view="e-pod">
                        <i class="bi bi-clipboard-check"></i>
                        <span class="nav-text">E-POD</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-view="active-deliveries">
                        <i class="bi bi-truck"></i>
                        <span class="nav-text">Active Deliveries</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-view="delivery-history">
                        <i class="bi bi-clipboard-check"></i>
                        <span class="nav-text">Delivery History</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-view="customers">
                        <i class="bi bi-people"></i>
                        <span class="nav-text">Customers</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-view="warehouse-map">
                        <i class="bi bi-geo-alt"></i>
                        <span class="nav-text">Warehouse Map</span>
                    </a>
                </li>

                <li class="nav-item">
                    <a href="#" class="nav-link" data-view="settings">
                        <i class="bi bi-gear"></i>
                        <span class="nav-text">Settings</span>
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="header">
            <div>
                <h1 class="page-title">
                    <i class="bi bi-calendar3"></i>
                    Delivery Management System
                </h1>
            </div>
            <div class="user-profile">
                <div class="user-avatar">JS</div>
                <div>
                    <div class="fw-bold">SMEG warehouse</div>
                    <div class="text-muted" style="font-size: 13px;">Logistics Manager</div>
                </div>
            </div>
        </div>

        <div class="content">
            <!-- Delivery Booking View -->
            <div id="booking-view" class="view active">
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-title">Booked Deliveries</div>
                        <div class="metric-value">24</div>
                        <div class="metric-change positive">
                            <i class="bi bi-arrow-up"></i> 12% from last week
                        </div>
                    </div>
                    <div class="metric-card" style="border-left-color: #3498db;">
                        <div class="metric-title">Active Deliveries</div>
                        <div class="metric-value">8</div>
                        <div class="metric-change negative">
                            <i class="bi bi-arrow-down"></i> 3% from last week
                        </div>
                    </div>
                    <div class="metric-card" style="border-left-color: #2ecc71;">
                        <div class="metric-title">Total Distance</div>
                        <div class="metric-value">1,248 km</div>
                        <div class="metric-change positive">
                            <i class="bi bi-arrow-up"></i> 18% from last week
                        </div>
                    </div>
                     <div class="metric-card" style="border-left-color: #e74c3c;">
                        <div class="metric-title">Revenue</div>
                        <div class="metric-value">â‚±14,280</div>
                        <div class="metric-change positive">
                            <i class="bi bi-arrow-up"></i> 22% from last week
                        </div>
                    </div>
                </div>

                <!-- Calendar Section -->
                <div class="calendar-container">
                    <div class="calendar-header">
                        <div class="month-nav">
                            <button class="btn btn-outline-secondary" id="prevMonth">
                                <i class="bi bi-chevron-left"></i>
                            </button>
                            <h2 id="currentMonth">Loading...</h2>
                            <button class="btn btn-outline-secondary" id="nextMonth">
                                <i class="bi bi-chevron-right"></i>
                            </button>
                        </div>
                         <div class="calendar-controls">
                            <button class="btn btn-outline-secondary active" data-view="month"><i class="bi bi-calendar-month"></i> Month</button>
                            <button class="btn btn-outline-secondary" data-view="week"><i class="bi bi-calendar-week"></i> Week</button>
                            <button class="btn btn-outline-secondary" data-view="day"><i class="bi bi-calendar-day"></i> Day</button>
                        </div>
                    </div>
                    <div class="calendar-grid" id="calendarGrid">
                        <!-- Calendar content will be generated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Analytics View -->
            <div id="analytics-view" class="view">
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h5 class="card-title">Bookings Over Time</h5>
                                    <div class="btn-group btn-group-sm" role="group">
                                        <button type="button" class="btn btn-outline-secondary active">Month</button>
                                        <button type="button" class="btn btn-outline-secondary">Week</button>
                                        <button type="button" class="btn btn-outline-secondary">Day</button>
                                    </div>
                                </div>
                                <canvas id="bookingsOverTimeChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                 <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Booking Origin Distribution</h5>
                                <canvas id="originChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Additional Cost Breakdown</h5>
                                <canvas id="costBreakdownChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- E-POD View -->
            <div id="e-pod-view" class="view">
                 <div class="card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="card-title"><i class="bi bi-pen"></i> E-POD</h5>
                            <div class="d-flex align-items-center gap-2">
                                <div class="btn-group" role="group">
                                    <span class="btn btn-outline-secondary search-icon-btn" style="pointer-events: none; border-right: none;">
                                        <i class="bi bi-search"></i>
                                    </span>
                                    <input type="text" class="form-control search-input" id="ePodSearchInput" placeholder="Search by DR Number..." style="min-width: 180px;">
                                    <button class="btn btn-outline-secondary search-clear-btn" type="button" id="clearEPodSearchBtn" title="Clear search">
                                        <i class="bi bi-x-lg"></i>
                                    </button>
                                </div>
                                <button class="btn btn-outline-secondary" id="exportEPodBtn"><i class="bi bi-download"></i> Export</button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="ePodSearchResultsInfo" class="search-results-info mb-3" style="display: none;">
                            <!-- Search results info will be displayed here -->
                        </div>
                        <div id="ePodCardsContainer" class="row">
                            <!-- E-POD cards will be loaded here -->
                        </div>
                        <div id="ePodPagination" class="d-flex justify-content-center mt-4">
                            <!-- Pagination controls will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Active Deliveries View -->
            <div id="active-deliveries-view" class="view">
                <div class="card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="card-title"><i class="bi bi-truck"></i> Active Deliveries</h5>
                            <div class="d-flex align-items-center gap-2">
                                <div class="btn-group" role="group">
                                    <span class="btn btn-outline-secondary search-icon-btn" style="pointer-events: none; border-right: none;">
                                        <i class="bi bi-search"></i>
                                    </span>
                                    <input type="text" class="form-control search-input" id="drSearchInput" placeholder="Search by DR Number..." style="min-width: 180px;">
                                    <button class="btn btn-outline-secondary search-clear-btn" type="button" id="clearSearchBtn" title="Clear search">
                                        <i class="bi bi-x-lg"></i>
                                    </button>
                                </div>
                                <button class="btn btn-outline-secondary" id="exportActiveDeliveriesBtn"><i class="bi bi-download"></i> Export</button>
                                <button class="btn btn-primary" id="eSignatureBtn" disabled><i class="bi bi-pen"></i> E-Signature</button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="searchResultsInfo" class="search-results-info mb-3" style="display: none;">
                            <!-- Search results info will be displayed here -->
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th style="width: 40px;"><input type="checkbox" class="form-check-input" id="selectAllActive"></th>
                                        <th>DR Number</th>
                                        <th>Customer Name</th>
                                        <th>Customer Number</th>
                                        <th>Origin</th>
                                        <th>Destination</th>
                                        <th>Distance</th>
                                        <th>Truck</th>
                                        <th>Status</th>
                                        <th>Booked Date</th>
                                    </tr>
                                </thead>
                                <tbody id="activeDeliveriesTableBody">
                                    <!-- Dynamic content will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Delivery History View -->
            <div id="delivery-history-view" class="view">
                <div class="card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="card-title"><i class="bi bi-clipboard-check"></i> Delivery History</h5>
                            <div class="d-flex align-items-center gap-2">
                                <div class="btn-group" role="group">
                                    <span class="btn btn-outline-secondary search-icon-btn" style="pointer-events: none; border-right: none;">
                                        <i class="bi bi-search"></i>
                                    </span>
                                    <input type="text" class="form-control search-input" id="drSearchHistoryInput" placeholder="Search by DR Number..." style="min-width: 180px;">
                                    <button class="btn btn-outline-secondary search-clear-btn" type="button" id="clearHistorySearchBtn" title="Clear search">
                                        <i class="bi bi-x-lg"></i>
                                    </button>
                                </div>
                                <button class="btn btn-outline-secondary" id="exportDeliveryHistoryBtn"><i class="bi bi-download"></i> Export</button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="historySearchResultsInfo" class="search-results-info mb-3" style="display: none;">
                            <!-- Search results info will be displayed here -->
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>DR Number</th>
                                        <th>Customer Name</th>
                                        <th>Customer Number</th>
                                        <th>Origin</th>
                                        <th>Destination</th>
                                        <th>Distance</th>
                                        <th>Additional Costs</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="deliveryHistoryTableBody">
                                    <!-- Dynamic content will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Customers View -->
            <div id="customers-view" class="view">
                <div class="card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="card-title"><i class="bi bi-people"></i> Customer Management</h5>
                            <button class="btn btn-primary" id="addCustomerBtn">
                                <i class="bi bi-plus-circle"></i> Add Customer
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row mb-4">
                            <div class="col-md-4">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                                    <input type="text" class="form-control" id="customerSearchInput" placeholder="Search customers...">
                                </div>
                            </div>
                            <div class="col-md-3 ms-auto">
                                <select class="form-select" id="customerFilterSelect">
                                    <option value="all">All Customers</option>
                                    <option value="active">Active Customers</option>
                                    <option value="pending">Pending Customers</option>
                                    <option value="top">Top Customers</option>
                                </select>
                            </div>
                        </div>

                        <div class="row g-4" id="customersContainer">
                            <!-- Customer cards will be dynamically loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Warehouse Map View -->
            <div id="warehouse-map-view" class="view">
                <div class="card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="card-title"><i class="bi bi-geo-alt"></i> Warehouse Locations & Saved Places</h5>
                            <div class="d-flex gap-2">
                                <span class="badge bg-success text-white px-3 py-2">
                                    <i class="bi bi-check-circle me-1"></i>
                                    Interactive Map
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- Map Instructions -->
                        <div class="alert alert-info d-flex align-items-center mb-4" role="alert">
                            <i class="bi bi-info-circle-fill me-3" style="font-size: 1.5rem;"></i>
                            <div>
                                <h6 class="alert-heading mb-1">Interactive Warehouse Map</h6>
                                <p class="mb-0">Click anywhere on the map to save custom locations. Use the controls to view saved locations and navigate between warehouses.</p>
                            </div>
                        </div>
                        
                        <!-- Interactive Map Container -->
                        <div id="warehouseMapContainer" style="height: 500px; border-radius: 12px; overflow: hidden; border: 2px solid #e0e6ed;">
                            <!-- Map will be initialized here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings View -->
            <div id="settings-view" class="view">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title"><i class="bi bi-gear"></i> System Settings</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="list-group" id="settingsList">
                                    <a href="#" class="list-group-item list-group-item-action active" data-setting="profile">
                                        <i class="bi bi-person me-2"></i> Profile Settings
                                    </a>
                                    <a href="#" class="list-group-item list-group-item-action" data-setting="notifications">
                                        <i class="bi bi-bell me-2"></i> Notification Preferences
                                    </a>
                                    <a href="#" class="list-group-item list-group-item-action" data-setting="delivery">
                                        <i class="bi bi-truck me-2"></i> Delivery Settings
                                    </a>
                                    <a href="#" class="list-group-item list-group-item-action" data-setting="integrations">
                                        <i class="bi bi-plug me-2"></i> System Integrations
                                    </a>
                                    <a href="#" class="list-group-item list-group-item-action" data-setting="security">
                                        <i class="bi bi-shield-lock me-2"></i> Security Settings
                                    </a>
                                    <a href="#" class="list-group-item list-group-item-action" data-setting="billing">
                                        <i class="bi bi-credit-card me-2"></i> Billing & Payments
                                    </a>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <!-- Setting Panels will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Delivery Booking Modal -->
    <div class="modal fade" id="bookingModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered modal-fullscreen-lg-down">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-calendar-check me-2"></i>Delivery Booking</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body booking-modal-body">
                    <form id="bookingForm">
                        <!-- Customer Details Section -->
                        <div class="form-section compact-section">
                            <h5 class="section-title"><i class="bi bi-person-circle"></i> Customer Details</h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <label for="customerName" class="form-label">Customer Name</label>
                                    <input type="text" class="form-control form-control-sm" id="customerName" placeholder="Enter customer name" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="customerNumber" class="form-label">Customer Number</label>
                                    <input type="tel" class="form-control form-control-sm" id="customerNumber" placeholder="Enter customer phone number" required>
                                </div>
                            </div>
                        </div>

                        <!-- DR Number Section -->
                        <div class="form-section compact-section">
                            <h5 class="section-title"><i class="bi bi-receipt"></i> Delivery Reference</h5>
                            <div class="row">
                                <div class="col-md-8">
                                    <label for="drNumber" class="form-label">DR Number</label>
                                    <div id="drNumbersContainer">
                                        <!-- DR Number inputs will be added here -->
                                    </div>
                                    <button type="button" class="btn btn-outline-secondary btn-sm" id="addDrBtn">
                                        <i class="bi bi-plus-circle me-1"></i>Add DR Number
                                    </button>
                                </div>
                                <div class="col-md-4">
                                    <label for="deliveryDate" class="form-label">Delivery Date</label>
                                    <input type="date" class="form-control form-control-sm" id="deliveryDate" required>
                                </div>
                            </div>
                        </div>

                        <!-- Other sections from the old UI can be added here -->

                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirmBookingBtn"><i class="bi bi-check-circle me-2"></i>Confirm Booking</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Other Modals (Add Customer, Edit Customer, E-Signature, etc.) -->

    <!-- Scripts -->
    <!-- SheetJS for Excel Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/dist/umd/supabase.js"></script>

    <!-- Chart.js for Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Signature Pad Library -->
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.5/dist/signature_pad.umd.min.js"></script>
    
    <!-- Application JavaScript Files -->
    <script src="assets/js/modal-utils.js"></script>
    <script src="assets/js/calendar.js"></script>
    <script src="assets/js/booking.js"></script>
    <script src="assets/js/customers.js"></script>
    <script src="assets/js/analytics.js"></script>
    <script src="assets/js/warehouse.js"></script>
    <script src="assets/js/app.js"></script>
</body>
</html>

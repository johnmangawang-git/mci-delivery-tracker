<!DOCTYPE html>
<html>
<head>
    <title>Debug Booking Integration</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-section { border: 1px solid #ccc; margin: 10px 0; padding: 15px; }
        .debug-output { background: #f5f5f5; padding: 10px; margin: 10px 0; font-family: monospace; }
        button { padding: 10px 15px; margin: 5px; }
        input { padding: 8px; margin: 5px; width: 200px; }
    </style>
</head>
<body>
    <h1>Debug Booking Integration</h1>
    
    <div class="debug-section">
        <h2>Test Customer Creation</h2>
        <input type="text" id="testName" placeholder="Customer Name" value="Debug Customer">
        <input type="text" id="testPhone" placeholder="Phone" value="+63 999 000 1111">
        <input type="text" id="testAddress" placeholder="Address" value="Debug Address, Manila">
        <button onclick="testCustomerCreation()">Test Customer Creation</button>
    </div>
    
    <div class="debug-section">
        <h2>Check Arrays</h2>
        <button onclick="checkArrays()">Check Customer Arrays</button>
        <button onclick="checkLocalStorage()">Check localStorage</button>
        <button onclick="clearData()">Clear All Data</button>
    </div>
    
    <div class="debug-section">
        <h2>Debug Output</h2>
        <div id="debugOutput" class="debug-output"></div>
    </div>
    
    <script>
        function log(message) {
            const output = document.getElementById('debugOutput');
            output.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '<br>';
            console.log(message);
        }
        
        function testCustomerCreation() {
            const name = document.getElementById('testName').value;
            const phone = document.getElementById('testPhone').value;
            const address = document.getElementById('testAddress').value;
            
            log('=== TESTING CUSTOMER CREATION ===');
            log('Name: ' + name);
            log('Phone: ' + phone);
            log('Address: ' + address);
            
            // Initialize arrays if they don't exist
            if (typeof window.customers === 'undefined') {
                window.customers = [];
                log('Initialized window.customers array');
            }
            
            if (typeof customers === 'undefined') {
                window.customers = [];
                log('customers variable not found, using window.customers');
            }
            
            // Check existing customers
            log('Current window.customers length: ' + window.customers.length);
            if (typeof customers !== 'undefined') {
                log('Current customers length: ' + customers.length);
            }
            
            // Create new customer
            const newCustomer = {
                id: 'CUST-' + String((window.customers?.length || 0) + 1).padStart(3, '0'),
                contactPerson: name,
                phone: phone,
                address: address,
                accountType: 'Individual',
                email: '',
                status: 'active',
                notes: 'Auto-created from debug test',
                bookingsCount: 1,
                lastDelivery: new Date().toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric' 
                }),
                createdAt: new Date()
            };
            
            // Add to arrays
            window.customers.push(newCustomer);
            log('Added to window.customers, new length: ' + window.customers.length);
            
            if (typeof customers !== 'undefined') {
                customers.push(newCustomer);
                log('Added to customers, new length: ' + customers.length);
            }
            
            // Save to localStorage
            localStorage.setItem('mci-customers', JSON.stringify(window.customers));
            log('Saved to localStorage');
            
            // Try to call loadCustomers if it exists
            if (typeof loadCustomers === 'function') {
                log('Calling loadCustomers()');
                loadCustomers();
            } else {
                log('loadCustomers function not found');
            }
            
            if (typeof window.loadCustomers === 'function') {
                log('Calling window.loadCustomers()');
                window.loadCustomers();
            } else {
                log('window.loadCustomers function not found');
            }
            
            log('Customer creation test completed');
        }
        
        function checkArrays() {
            log('=== CHECKING ARRAYS ===');
            log('window.customers exists: ' + (typeof window.customers !== 'undefined'));
            if (window.customers) {
                log('window.customers length: ' + window.customers.length);
                log('window.customers content: ' + JSON.stringify(window.customers, null, 2));
            }
            
            log('customers exists: ' + (typeof customers !== 'undefined'));
            if (typeof customers !== 'undefined') {
                log('customers length: ' + customers.length);
                log('customers content: ' + JSON.stringify(customers, null, 2));
            }
        }
        
        function checkLocalStorage() {
            log('=== CHECKING LOCALSTORAGE ===');
            const saved = localStorage.getItem('mci-customers');
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    log('localStorage mci-customers length: ' + parsed.length);
                    log('localStorage content: ' + JSON.stringify(parsed, null, 2));
                } catch (e) {
                    log('Error parsing localStorage: ' + e.message);
                }
            } else {
                log('No mci-customers in localStorage');
            }
        }
        
        function clearData() {
            localStorage.removeItem('mci-customers');
            if (window.customers) window.customers.length = 0;
            if (typeof customers !== 'undefined') customers.length = 0;
            log('Cleared all customer data');
        }
        
        // Initialize on load
        window.addEventListener('load', function() {
            log('Page loaded, checking initial state...');
            checkArrays();
            checkLocalStorage();
        });
    </script>
</body>
</html>
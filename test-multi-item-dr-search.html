<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Item DR Search Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="public/assets/css/style.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0"><i class="bi bi-search me-2"></i>Multi-Item DR Search Test</h4>
                    </div>
                    <div class="card-body">
                        <!-- Search Form -->
                        <form id="trackingForm" class="mb-4">
                            <div class="input-group">
                                <input type="text" 
                                       id="trackingInput" 
                                       class="form-control form-control-lg" 
                                       placeholder="Enter DR Number (e.g., DR-2024-001)"
                                       required>
                                <button type="submit" 
                                        id="trackingButton" 
                                        class="btn btn-primary btn-lg">
                                    <i class="bi bi-search me-1"></i>Track Delivery
                                </button>
                            </div>
                        </form>

                        <!-- Test Data Generator -->
                        <div class="alert alert-info">
                            <h6><i class="bi bi-info-circle me-2"></i>Test Data</h6>
                            <p class="mb-2">Click to generate test data for DR search:</p>
                            <button onclick="generateTestData()" class="btn btn-sm btn-outline-primary me-2">
                                Generate Test DR Data
                            </button>
                            <button onclick="clearTestData()" class="btn btn-sm btn-outline-danger">
                                Clear Test Data
                            </button>
                        </div>

                        <!-- Search Results -->
                        <div id="trackingResults" style="display: none;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Test Data Display -->
    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h6><i class="bi bi-database me-2"></i>Current Test Data</h6>
                    </div>
                    <div class="card-body">
                        <div id="testDataDisplay">
                            <p class="text-muted">No test data generated yet.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="public/assets/js/delivery-tracking.js"></script>
    
    <script>
        // Generate test data for multi-item DR search
        function generateTestData() {
            const testData = [
                {
                    dr_number: 'DR-2024-001',
                    customer_name: 'John Doe',
                    delivery_date: '2024-10-25',
                    destination: '123 Main Street, Makati City',
                    origin: 'MCI Warehouse',
                    status: 'In Transit',
                    item_description: 'iPhone 15 Pro',
                    serial_number: 'ABC123456789',
                    mobile_number: '09171234567',
                    item_number: 'ITM001',
                    created_at: '2024-10-23T10:00:00Z'
                },
                {
                    dr_number: 'DR-2024-001',
                    customer_name: 'John Doe',
                    delivery_date: '2024-10-25',
                    destination: '123 Main Street, Makati City',
                    origin: 'MCI Warehouse',
                    status: 'In Transit',
                    item_description: 'MacBook Air M2',
                    serial_number: 'DEF987654321',
                    mobile_number: '09171234567',
                    item_number: 'ITM002',
                    created_at: '2024-10-23T10:01:00Z'
                },
                {
                    dr_number: 'DR-2024-001',
                    customer_name: 'John Doe',
                    delivery_date: '2024-10-25',
                    destination: '123 Main Street, Makati City',
                    origin: 'MCI Warehouse',
                    status: 'Delivered',
                    item_description: 'AirPods Pro',
                    serial_number: 'GHI456789123',
                    mobile_number: '09171234567',
                    item_number: 'ITM003',
                    created_at: '2024-10-23T10:02:00Z'
                },
                {
                    dr_number: 'DR-2024-002',
                    customer_name: 'Jane Smith',
                    delivery_date: '2024-10-26',
                    destination: '456 Business Ave, BGC Taguig',
                    origin: 'MCI Warehouse',
                    status: 'Active',
                    item_description: 'Samsung Galaxy S24',
                    serial_number: 'JKL789123456',
                    mobile_number: '09189876543',
                    item_number: 'ITM004',
                    created_at: '2024-10-23T11:00:00Z'
                },
                {
                    dr_number: 'DR-2024-002',
                    customer_name: 'Jane Smith',
                    delivery_date: '2024-10-26',
                    destination: '456 Business Ave, BGC Taguig',
                    origin: 'MCI Warehouse',
                    status: 'Active',
                    item_description: 'Samsung Watch 6',
                    serial_number: 'MNO123456789',
                    mobile_number: '09189876543',
                    item_number: 'ITM005',
                    created_at: '2024-10-23T11:01:00Z'
                }
            ];

            // Store in localStorage for testing
            localStorage.setItem('mci-active-deliveries', JSON.stringify(testData));
            
            displayTestData();
            
            alert('Test data generated! You can now search for:\n- DR-2024-001 (3 items)\n- DR-2024-002 (2 items)');
        }

        // Clear test data
        function clearTestData() {
            localStorage.removeItem('mci-active-deliveries');
            localStorage.removeItem('mci-delivery-history');
            displayTestData();
            document.getElementById('trackingResults').style.display = 'none';
            alert('Test data cleared!');
        }

        // Display current test data
        function displayTestData() {
            const activeDeliveries = JSON.parse(localStorage.getItem('mci-active-deliveries') || '[]');
            const testDataDisplay = document.getElementById('testDataDisplay');
            
            if (activeDeliveries.length === 0) {
                testDataDisplay.innerHTML = '<p class="text-muted">No test data available.</p>';
                return;
            }

            let html = '<div class="table-responsive"><table class="table table-sm">';
            html += '<thead><tr><th>DR Number</th><th>Customer</th><th>Item</th><th>Serial</th><th>Status</th></tr></thead><tbody>';
            
            activeDeliveries.forEach(item => {
                html += `
                    <tr>
                        <td><code>${item.dr_number}</code></td>
                        <td>${item.customer_name}</td>
                        <td>${item.item_description}</td>
                        <td><small>${item.serial_number}</small></td>
                        <td><span class="badge bg-info">${item.status}</span></td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            testDataDisplay.innerHTML = html;
        }

        // Initialize display on page load
        document.addEventListener('DOMContentLoaded', function() {
            displayTestData();
        });

        // Make toggleItems globally available
        window.toggleItems = function(groupId) {
            const itemsList = document.getElementById(`items-${groupId}`);
            const chevron = document.getElementById(`chevron-${groupId}`);
            
            if (itemsList && chevron) {
                if (itemsList.classList.contains('show')) {
                    itemsList.classList.remove('show');
                    chevron.classList.remove('bi-chevron-up');
                    chevron.classList.add('bi-chevron-down');
                } else {
                    itemsList.classList.add('show');
                    chevron.classList.remove('bi-chevron-down');
                    chevron.classList.add('bi-chevron-up');
                }
            }
        };
    </script>
</body>
</html>